---
title: Supprimer un objet
sidebar:
  order: 1
---

Un des aspects importants dans l'amélioration des performances et qui permet d'éviter les fuites de mémoire dans votre application est la suppression des entités non-utilisées de la librairie.
Dès que vous créez une instance d'un type _three.js_, vous allouez une certaine quantité de mémoire. Toutefois, _three.js_ crée pour certains objets
comme les formes ou les matériaux, des entités WebGL associées comme des buffers ou des programmes de shaders qui sont nécessaires au rendu. Il est important de
souligner que ces objets ne sont pas automatiquement débarrassés. Au contraire, l'application doit utiliser une API particulière pour libérer ce genre de ressources.
Ce guide vous fournit une brève vue d'ensemble du fonctionnement de cette API et des objets considérés comme pertinents dans ce contexte.

## Formes

Une forme représente généralement des informations concernant des sommets présentés comme un ensemble d'attributs. _three.js_ crée en interne un objet de type [ WebGLBuffer](https://developer.mozilla.org/en-US/docs/Web/API/WebGLBuffer)
pour chaque attribut. Ces entités sont supprimées uniquement si vous appelez [BufferGeometry](api/core/BufferGeometry#dispose)(). Si une forme devient obsolète dans votre application,
exécutez cette méthode pour libérer toutes les ressources associées.

## Matériaux

Un matériau définit comment un objet est rendu. _three.js_ utilise les informations de la définition du matériau pour construire un programme de shader pour le rendu.
Les programmes de shader peuvent être supprimés seulement si leur matériau respectif est supprimé. Dans un souci de performances, _three.js_ essaye de réutiliser des
programmes de shaders existants si possible. Donc un programme de shader est supprimé uniquement si tous les matériaux associés sont supprimés. Vous pouvez indiquer la suppression d'un matériau en
exécutant [Material](api/materials/Material#dispose)().

## Textures

La suppression d'un matériau n'a aucun effet sur les textures. Elles sont gérées séparément étant donné qu'une seule texture peut-être utilisée par plusieurs matériaux au même moment.
Chaque fois que vous créez une instance de [Texture](api/textures/Texture), three.js crée en interne une instance de [ WebGLTexture](https://developer.mozilla.org/en-US/docs/Web/API/WebGLTexture).
Comme les buffers, cet objet ne peut-être supprimé qu'en appelant [Texture](api/textures/Texture#dispose)().

Si vous utilisez une `ImageBitmap` comme source de données pour une texture, vous devez appeler [ ImageBitmap.close](https://developer.mozilla.org/en-US/docs/Web/API/ImageBitmap/close)() au niveau de l'application pour libérer toutes les ressources côté processeur.
Un appel automatisé de `ImageBitmap.close()` dans [Texture](api/textures/Texture#dispose)() n'est pas possible, étant donné que le bitmap devient inutilisable, et que le moteur n'a aucun moyen de savoir si l'image bitmap est utilisée ailleurs.

## Cibles de rendu

Les objets de type [WebGLRenderTarget](api/renderers/WebGLRenderTarget) n'allouent pas qu'une instance de [ WebGLTexture](https://developer.mozilla.org/en-US/docs/Web/API/WebGLTexture) mais également
[ WebGLFramebuffer](https://developer.mozilla.org/en-US/docs/Web/API/WebGLFramebuffer)s et [ WebGLRenderbuffer](https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderbuffer)s
pour réaliser des rendus customisés. Ces objets ne sont désalloués qu'en exécutant [WebGLRenderTarget](api/renderers/WebGLRenderTarget#dispose)().

## Divers

Il y a d'autres classes du dossier example comme controls ou les effets de post processings qui fournissent la méthode `dispose()` pour retirer des event listeners internes
ou des cibles de rendu. En général, il est recommandé de jeter un coup d'oeil à l'API ou à la documentation d'une classe en cherchant un `dispose()`. Si il existe, vous devez l'utiliser pour faire votre petit ménage après utilisation.

## FAQ

### Pourquoi _three.js_ ne peut pas supprimer automatiquement les objets?

Cette question a été posée énormément de fois par la communauté, il est donc important de clarifier ce sujet. Le fait est que _three.js_ ne connaît pas la durée de vie ou la portée des
entités comme les formes ou les matériaux créés par les utilisateurs. Il en va de la responsabilité de l'application. Par exemple, si un matériau n'est pas utilisé pour le rendu pour l'instant,
il peut être nécessaire pour le prochain frame. Donc si l'application décide qu'un certain objet peut-être supprimé, elle doit en notifier le moteur en appelant la méthode
`dispose()`.

### Retirer un mesh de la scène supprime également sa forme et son matériau?

Non, vous devez explicitement supprimer la forme et le matériau via _dispose()_. Gardez à l'esprit que les formes et matériaux peuvent être partagés entre plusieurs objets 3D comme les meshes.

### Est-ce que _three.js_ fournit des informations à propos des objets en cache?

Oui. Il est possible d'interroger [WebGLRenderer](api/renderers/WebGLRenderer#info), qui est une propriété spéciale du moteur de rendu avec une série d'informations et de statistiques à propos de l'usage graphique
et du processus de rendu. Entre autres, cela peut vous donner des informations comme le nombre de textures, de formes et de programmes de shaders stockés en interne. Si vous remarquez des problèmes de performance
dans votre application, une bonne idée serait de débugger cette propriété pour facilement identifier une fuite de mémoire.

### Que se passe t-il quand on appelle `dispose()` sur une texture mais que l'image n'est pas encore chargée?

Des ressources internes sont allouées pour une texture uniquement si l'image est entièrement chargée. Si vous supprimez une texture avant que l'image soit chargée,
rien ne se produit. Aucune ressource n'était allouée il n'y a donc rien à libérer.

### Que se passe t-il quand on appelle `dispose()` puis qu'on utilise l'objet plus tard?

Les ressources internes libérées sont réallouées par le moteur. Il n'y aura donc pas d'erreur d'exécution mais vous remarquerez probablement un impact négatif sur les performances au frame actuel,
particulièrement quand le programme de shaders doit-être compilé.

### Comment gérer les objets _three.js_ dans mon application? Quand dois-je supprimer les objets?

En général, il n'y a pas de recommandation universelle pour cette question. Savoir si l'utilisation de `dispose()` est appropriée dépend grandement des cas d'utilisation. Il est important de souligner qu'il
n'est pas nécessaire de toujours se débarrasser des objets. Un bon exemple serait un jeu avec de multiple niveaux. Le bon moment pour supprimer les objets serait à un changement
de niveau. L'application devrait traverser les anciennes scènes et supprimer tous les matériaux, les formes et les textures obsolètes. Comme mentionné dans la section précédente, supprimer des
objets toujours utilisés ne produit pas d'erreur d'exécution. La pire chose qui pourrait se produire serait une baisse de la performance à un seul frame.

## Exemples qui montrent l'utilisation de dispose()

[example:webgl_test_memory WebGL / test / memory]

[example:webgl_test_memory2 WebGL / test / memory2]
