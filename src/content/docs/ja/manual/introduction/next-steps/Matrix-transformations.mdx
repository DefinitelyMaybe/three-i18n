---
title: 行列の変換
sidebar:
  order: 4
---

Three.jsは行列(_matrices_)を使って3次元変換(位置の変換、回転、スケーリング)をエンコードします。
すべての[Object3D](api/core/Object3D)インスタンスは、そのオブジェクトの位置や回転、スケールを保存した行列([Object3D](api/core/Object3D#matrix
matrix))を持っています。このページではオブジェクトの３次元変換をどうやって行うかを説明しています。

## Convenience properties and _matrixAutoUpdate_(便利なプロパティとmatrixAutoUpdate)

オブジェクトの変換を更新するには二つの方法があります。

<ol>
<li>
オブジェクトの*position*や*quaternion*(四元数)や<strong>スケールのプロパティ</strong>を変更することで、three.jsに
オブジェクトの行列を再計算させます。

```javascript
object.position.copy(start_position);
object.quaternion.copy(quaternion);
```

デフォルトでは、*matrixAutoUpdate*のプロパティはtrueで、行列は自動的に再計算されます。
オブジェクトが静的な場合や、再計算するタイミングを制御したい場合は、このプロパティをfalseに設定することでパフォーマンスが改善する可能性があります。

```javascript
object.matrixAutoUpdate = false;
```

プロパティを変更した後には、行列を手動で更新してください。

```javascript
object.updateMatrix();
```

</li>
<li>
オブジェクトの行列を直接修正する方法です。
[Matrix4](api/math/Matrix4)クラスには行列を変更するための様々なメソッドがあります。

```javascript
object.matrix.setRotationFromQuaternion(quaternion);
object.matrix.setPosition(start_position);
object.matrixAutoUpdate = false;
```

この場合 *matrixAutoUpdate*は*false*に設定*しなくてはならない*ことに注意してください。
また*updateMatrix*を呼ば*ない*ようにしてください。
*updateMatrix*を呼ぶと、行列にマニュアルで加えた変更がなくなり、<strong>位置やスケール</strong>などから行列が再計算されます。

</li>
</ol>

## Object and world matrices(オブジェクトとワールド座標系での行列)

オブジェクトの行列([matrix](api/core/Object3D#matrix))は、[parent](api/core/Object3D#parent)(親オブジェクト)に対する*相対的な*変換を保持しています。
*ワールド座標系での*オブジェクトの変換を取得するには、オブジェクトの[Object3D](api/core/Object3D#matrixWorld)にアクセスする必要があります。

親オブジェクトや子オブジェクトの変換が変更された場合は、[updateMatrixWorld](api/core/Object3D#updateMatrixWorld)()を呼び出すことで、子オブジェクトの[matrixWorld](api/core/Object3D#matrixWorld)の更新を要求することができます。

## Rotation and Quaternion(回転と四元数)

three.jsでは3次元の回線を表すためにオイラー角([Euler angles](api/math/Euler))と4元数([Quaternions](api/math/Quaternion))という2つの方法があります。
また、three.jsではこの2つの間の変換メソッドも提供されています。
オイラー角はgimbal lockと呼ばれる問題の影響をうけることがあります。
gimbal lockが発生すると、特定の設定のときにオブジェクトの回転の自由度が失われます(オブジェクトが特定の軸方向に回転できなくなります)
このため、オブジェクトの回転は*つねに*オブジェクトの4元数([quaternion](api/core/Object3D#quaternion))に保持されます。

以前のバージョンのライブラリには*useQuaternion*プロパティがあり、これをfalseに設定すると、
オブジェクトの行列([matrix](api/core/Object3D#matrix))がオイラー角から計算されるようになっていました。
このやり方は古くなってきたので、代わりに[setRotationFromEuler](api/core/Object3D#setRotationFromEuler)メソッドを使用して、
四元数を更新します。
