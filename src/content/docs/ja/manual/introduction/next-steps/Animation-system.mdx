---
title: アニメーションシステム
sidebar:
  order: 5
---

## 概要

three.jsのアニメーションシステムの中では、モデルの様々なプロパティをアニメーション化できます。
例えば、装飾を行なったモデル([skinned and rigged model](api/objects/SkinnedMesh))の骨格や、morphTargets、異なるマテリアルの要素(色、不透明度、有無)、可視性、変形などを操作できます。
アニメーションの要素は、フェードインやフェードアウト、クロスフェード、重ね合わせが可能です。
同一のオブジェクトであっても異なるものであっても、異なるアニメーションの比重やタイムスケールは独立して変更出来ます。また、同じオブジェクトでも、異なるオブジェクトでもアニメーションは同期出来ます。

これらを一つのシステムで達成するために、three.jsのアニメーションシステムは2015に完全に変更されました([ link](https://github.com/mrdoob/three.js/issues/6881))。古い情報に気をつけてください！three.jsのアニメーションシステムは現在はUnityやUnreal Engine 4と似た設計になっています。このページではメインの要素と、それがどうやって動くのかを簡単に説明します。

### Animation Clips

アニメーション付きの3Dオブジェクトをインポートすることに成功した場合(そのオブジェクトが骨格なのか、モーフターゲットなのか、はたまた両方なのかには関係なく)、レスポンスフィールドのうちの一つは"animations"という配列で、そのモデルの[AnimationClips](api/animation/AnimationClip)を含んでいるはずです(下記の利用可能なローダーを参照)。
アニメーション付きの3Dオブジェクトをインポートすることに成功する状況というのは、例えばBlenderから[ glTF Blender exporter](https://github.com/KhronosGroup/glTF-Blender-IO)でオブジェクトをエクスポートして、そのオブジェクトを[GLTFLoader](examples/loaders/GLTFLoader)を使って、three.jsに読みこむ、といったことが挙げられます。

*AnimationClip*は普通、オブジェクトの特定の動作のデータを持っています。
例えば、メッシュの場合、1つめのAnimationClipはウォークサイクルのためのもの、2つ目のAnimationClipはジャンプ用の、3つ目はサイドステップ用という風に動作のデータをAnimationClipに持たせています。

### Keyframe Tracks

こういった*AnimationClip*の中では、アニメーションの要素のデータは別の[KeyframeTrack](api/animation/KeyframeTrack)に保存されています。キャラクターオブジェクトが骨格を持っていると仮定すると、あるキートラックフレームは腕の下の方の骨の、位置の時間変化のデータを保存し、別のキートラックは同じ骨の回転成分の動きのデータを保存し、また別のキートラックは他の骨の位置や回転、スケールの変化といったデータを保存します。AnimationClipは、このようなたくさんのトラックで構成できることがわかります。

モデルがmorph targetsを持っていると仮定すると(例えば、友好的な顔から怒った顔にモーフィングするような場合)、それぞれのトラックは特定のモーフィングターゲットの[influence](api/objects/Mesh#morphTargetInfluences)がclipのパフォーマンス中にどうやって変化するかについての情報を持っています。

### Animation Mixer

保存されたデータは、アニメーションのベースを形成するだけで、実際のアニメーションの再生は[AnimationMixer](api/animation/AnimationMixer)によってコントロールされます。AnimationMixerはアニメーションのプレイヤーであるだけでなく、本物のミキサーコンソールのようなハードウェアのシミレーションでもあります。これによって、複数のアニメーションを同時にコントロールして、ブレンドしたり、マージしたり出来ます。

### Animation Actions

[AnimationActions](api/animation/AnimationAction)によってコントールできるので、*AnimationMixer*自体の(一般的な)メソッドやプロパティは少ないです。*AnimationAction*を設定することで、あるミキサー上での*AnimationClip*の再生や、一時停止、停止のタイミングであったり、clipをリピートする頻度やリピートの有無、フェードや時間変化の有無、クロスフェードやシンクロなどの補助的なことを設定することが出来ます。

### Animation Object Groups

オブジェクトのグループに、アニメーションの状態を受け取らせたい場合は、[AnimationObjectGroup](api/animation/AnimationObjectGroup)が使えます。

### サポートされているフォーマットとloader

全てのモデル形式がアニメーションを含んでいるわけではないことに注意してください(OBJは特に含まれていません)。
またthree.jsのloaderのうちのいくつかしか[AnimationClip](api/animation/AnimationClip)シーケンスをサポートしていないことにも注意してください。このアニメーションのタイプをサポートしているものがいくつかあります。

<ul>
  <li>[THREE.ObjectLoader](api/loaders/ObjectLoader)</li>
  <li>THREE.BVHLoader</li>
  <li>THREE.ColladaLoader</li>
  <li>THREE.FBXLoader</li>
  <li>[THREE.GLTFLoader](examples/loaders/GLTFLoader)</li>
</ul>

3ds maxとMayaは今のところ、複数のアニメーション(同じタイムラインにないもの)を一つのファイルに直接エクスポートすることは出来ません

## Example

```javascript
let mesh;

// Create an AnimationMixer, and get the list of AnimationClip instances
const mixer = new THREE.AnimationMixer(mesh);
const clips = mesh.animations;

// Update the mixer on each frame
function update() {
  mixer.update(deltaSeconds);
}

// Play a specific animation
const clip = THREE.AnimationClip.findByName(clips, "dance");
const action = mixer.clipAction(clip);
action.play();

// Play all animations
clips.forEach(function (clip) {
  mixer.clipAction(clip).play();
});
```
